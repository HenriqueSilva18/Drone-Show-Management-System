@startuml
' Advanced DDD Domain Model for Shodrone System (Without Factories)

' ========== CORE DOMAIN ==========
package "Core Domain" {
    ' ========== ENTIDADES & AGREGADOS ==========
    class User <<Entity>> {
        - id: UserId
        - username: Username
        - password: Password
        - email: String
        - phone: String
    }

    class Client <<Entity>> {
        - clientId: ClientId
        - vat: String
        - address: String
    }

    class DroneModel <<Entity>> {
        - id: DroneModelId
        - name: String
        - language: String
    }

    class Drone <<AggregateRoot>> {
        - id: DroneId
        - droneModel: DroneModel
        - serialNumber: String
        - state: DroneState
        - maintenance_history: List<Maintenance>
    }

    class Show <<AggregateRoot>> {
        - id: ShowId
        - date: DateValue
        - figures: List<Figure>
        - drones: List<Drone>
    }

    class Figure <<Entity>> {
        - id: FigureId
        - description: Description
        - dslCode: String
        - version: String
        - exclusive: Boolean
    }

    class ShowProposal <<Entity>> {
        - id: ProposalId
        - show: Show
    }

    class ShowRequest <<Entity>> {
        - id: ShowRequestId
        - client: Client
        - place: String
        - time: DateValue
        - numberOfDrones: Integer
        - description: Description
        - status: RequestStatus
    }

    ' ========== VALUE OBJECTS ==========
    class UserId <<ValueObject>> {
        - value: String
    }

    class ClientId <<ValueObject>> {
        - value: String
    }

    class DroneId <<ValueObject>> {
        - value: String
    }

    class DroneModelId <<ValueObject>> {
        - value: String
    }

    class ShowId <<ValueObject>> {
        - value: String
    }

    class FigureId <<ValueObject>> {
        - value: String
    }

    class ProposalId <<ValueObject>> {
        - value: String
    }

    class ShowRequestId <<ValueObject>> {
        - value: String
    }

    class Username <<ValueObject>> {
        - value: String
    }

    class Password <<ValueObject>> {
        - value: String
    }

    class DroneState <<ValueObject>> {
        - value: String
    }

    class Maintenance <<ValueObject>> {
        - maintenance_start_date: DateValue
        - maintenance_final_date: DateValue
    }

    class DateValue <<ValueObject>> {
        - value: String
    }

    class Description <<ValueObject>> {
        - value: String
    }

    class RequestStatus <<ValueObject>> {
        - value: String
    }

    class Position <<ValueObject>> {
        - x: Integer
        - y: Integer
        - z: Integer
    }

    ' ========== EVENTOS DE DOMÍNIO =========
    class DroneMaintenanceCompletedEvent <<DomainEvent>> {
        - droneId: DroneId
        - maintenance: Maintenance
        - occurredOn: DateValue
    }

    class ShowScheduledEvent <<DomainEvent>> {
        - showId: ShowId
        - scheduledDate: DateValue
    }

    class CollisionDetectedEvent <<DomainEvent>> {
        - droneId: DroneId
        - position: Position
        - timestamp: DateValue
    }

    ' ========== REPOSITÓRIOS =========
    interface DroneRepository <<Repository>> {
        + save(drone: Drone): void
        + findById(id: DroneId): Drone
        + findAvailableDrones(): List<Drone>
    }

    interface ShowRepository <<Repository>> {
        + save(show: Show): void
        + findById(id: ShowId): Show
    }

    interface ShowRequestRepository <<Repository>> {
        + save(request: ShowRequest): void
        + findById(id: ShowRequestId): ShowRequest
    }

    ' ========== ESPECIFICAÇÕES =========
    class DroneAvailableSpecification <<Specification>> {
        + isSatisfiedBy(drone: Drone): Boolean
    }

    ' ========== SERVIÇOS DE DOMÍNIO =========
    class Inventory <<DomainService>> {
        + getAvailableDrones(): List<Drone>
    }

    class SimulationService <<DomainService>> {
        + simulateFigure(figure: Figure): String
    }

    ' ========== SERVIÇOS DE APLICAÇÃO =========
    class ShowApplicationService <<ApplicationService>> {
        + scheduleShow(showProposal: ShowProposal): ShowScheduledEvent
    }
}

' ========== CAMADA DE ANTICORRUPÇÃO ==========
package "Anti-Corruption Layer" {
    class ExternalDroneSystemAdapter <<AntiCorruptionLayer>> {
        + fetchDroneStatus(droneId: String): String
    }
}

' ========== RELAÇÕES ==========
' Entidades e seus Value Objects
User --> UserId
User --> Username
User --> Password

Client --> ClientId

DroneModel --> DroneModelId

Drone --> DroneId
Drone --> DroneState
Drone --> Maintenance
Drone --> DroneModel

Show --> ShowId
Show --> DateValue
Show --> Figure
Show --> Drone

Figure --> FigureId
Figure --> Description

ShowProposal --> ProposalId
ShowProposal --> Show

ShowRequest --> ShowRequestId
ShowRequest --> Client
ShowRequest --> DateValue
ShowRequest --> Description
ShowRequest --> RequestStatus

Maintenance --> DateValue

' Eventos de Domínio
Drone "1" --> "0..*" DroneMaintenanceCompletedEvent : triggers
Show "1" --> "0..*" ShowScheduledEvent : triggers
Drone "1" --> "0..*" CollisionDetectedEvent : triggers

' Repositórios para acesso aos Agregados
DroneRepository ..> Drone
ShowRepository ..> Show
ShowRequestRepository ..> ShowRequest

' O serviço de domínio utiliza a especificação
Inventory ..> DroneAvailableSpecification : uses

' Serviço de aplicação interage com o repositório e dispara evento
ShowApplicationService ..> ShowRepository : uses
ShowApplicationService ..> ShowScheduledEvent : triggers

' Integração com sistemas externos via Anti-Corruption Layer
Inventory ..> ExternalDroneSystemAdapter : integra

@enduml
